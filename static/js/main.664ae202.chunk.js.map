{"version":3,"sources":["flightsearch.js","cachedFetch.js","AirportSelector.js","Form.js","ResultsTable.js","App.js","index.js"],"names":["formatKiwiDate","date","moment","format","addDays","days","result","Date","setDate","getDate","getFaresFromAirport","throttle","airport","state","a","async","dateFlexibility","dateFrom","departureDate","dateTo","returnFrom","returnDate","returnTo","fareURL","buildUrl","path","queryParams","fly_from","id","curr","ret_from_diff_airport","fly_to","destination","undefined","max_stopovers","replace","fetch","json","flights","data","arrayToDict","map","forEach","flight","getKey","push","cityCodeTo","getCandidates","yourFares","theirFares","candidates","Object","keys","yourOrigin","theirOrigin","yourFaresDict","theirFaresDict","yourFaresToDestination","yourFaresToDestinationDict","newCandidates","theirFaresToDestination","theirFaresToDestinationDict","getFares","cachedFetch","url","expiry","cachedString","localStorage","getItem","cached","JSON","parse","now","removeItem","fetched","setItem","stringify","useStyles","makeStyles","theme","icon","color","palette","text","secondary","marginRight","spacing","getURL","locationSearch","term","locations","location","assign","AirportSelector","props","classes","React","useState","inputValue","setInputValue","options","setOptions","handleSearch","event","value","target","ourFetch","useMemo","input","callback","useEffect","active","results","Autocomplete","style","width","getOptionLabel","option","name","filterOptions","x","onChange","renderInput","params","TextField","required","label","variant","fullWidth","renderOption","parts","match","Grid","container","alignItems","item","className","xs","part","index","key","fontWeight","highlight","Typography","nextThursday","add","isoWeekday","requiredParams","fillDefault","whichAirport","locationJson","filter","Form","allowSubmit","doStuff","handleChange","e","this","setState","query","bind","startLoading","finishLoading","handleSubmit","setDepartureDate","prevProps","prevState","snapshot","oldMatch","newMatch","setAirport","which","newState","preventDefault","reduce","tot","par","loading","newDate","clearCandidates","setQuery","toDate","fares","addCandidates","onSubmit","sm","md","xl","utils","MomentUtils","DatePicker","disablePast","inputVariant","d","minDate","Button","disabled","onClick","Component","ResultsTable","setYourFlight","newValue","yourFlight","setTheirFlight","theirFlight","indexOf","expand","Paper","Tabs","scrollButtons","values","candidate","myFirst","price","minPrice","cityTo","countryTo","Tab","FlightSelector","sortBy","setSortBy","yourMaxPrice","theirMaxPrice","setYourMaxPrice","setTheirMaxPrice","SelectedFlights","Math","min","fare","formatTime","time","addYoursOrTheirs","yoursOrTheirs","sort","y","sign","utc_departure","utc_arrival","route","length","data_param","type","role","p","maxPrice","yours","theirs","selection","previousLeg","returnLeg","there","flyFrom","flyTo","local_departure","local_arrival","back","tooltip","output","leg","colors","flight_color","gap_color","bars","fareToDatum","flat","chartEvents","eventName","chartSelection","chartWrapper","getChart","getSelection","selectedFareID","row","selectedFare","console","error","yourMax","f","max","theirMax","yourMin","Infinity","theirMin","gutterBottom","Select","MenuItem","Slider","defaultValue","onChangeCommitted","valueLabelDisplay","height","chartType","loader","timeline","colorByRowLabel","groupByRowLabel","showRowLabels","isHtml","rootProps","c","Flight","clearFlight","Card","CardHeader","title","cityFrom","action","IconButton","aria-label","Avatar","src","airline","CardContent","CardActions","Link","rel","href","deep_link","Loading","window","updateLocale","week","dow","App","useQueryParams","StringParam","DateParam","NumberParam","setLoading","setCandidates","routing","ReactRouterRoute","Route","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.664ae202.chunk.js","sourcesContent":["import throttle from 'lodash/throttle';\nimport buildUrl from 'build-url';\nimport moment from \"moment\";\n\nfunction formatKiwiDate(date) {\n    return moment(date).format('DD/MM/YYYY');\n}\n\nfunction addDays(date, days) {\n  const result = new Date(date);\n  result.setDate(result.getDate() + days);\n  return result;\n}\n\nconst getFaresFromAirport = throttle(\n    async function (airport, state) {\n        const dateFlexibility = state.dateFlexibility || 0;\n        const dateFrom = addDays(state.departureDate, -dateFlexibility);\n        const dateTo = addDays(state.departureDate, dateFlexibility);\n        const returnFrom = addDays(state.returnDate, -dateFlexibility);\n        const returnTo = addDays(state.returnDate, dateFlexibility);\n        const fareURL = buildUrl(\n            'https://kiwiproxy.herokuapp.com',\n            {\n                path: \"v2/search\",\n                queryParams: {\n                    fly_from: airport.id,\n                    dateFrom: formatKiwiDate(dateFrom),\n                    dateTo: formatKiwiDate(dateTo),\n                    returnFrom: formatKiwiDate(returnFrom),\n                    returnTo: formatKiwiDate(returnTo),\n                    curr: 'EUR',\n                    ret_from_diff_airport: 0,\n                    fly_to: state.destination ? state.destination.id : undefined,\n                    max_stopovers: state.max_stopovers || 0\n                }\n            }\n        ).replace(/%2F/g, '/');\n        const flights = (await (await fetch(fareURL)).json()).data;\n        return flights;\n    },\n    200\n);\n\nfunction arrayToDict(flights, map = {}) {\n    flights.forEach(\n        (flight) => {\n            if(getKey(flight) in map) map[getKey(flight)].push(flight);\n            else map[getKey(flight)] = [flight];\n            return map;\n        },\n        {}\n    );\n    return map;\n}\n\nfunction getKey(flight) {\n    return flight.cityCodeTo;\n}\n\nfunction getCandidates({yourFares, theirFares}) {\n    const candidates = {};\n    for(const destination of Object.keys(theirFares)) {\n        if(destination in yourFares);\n        else continue;\n        candidates[destination] = {\n            yourFares: yourFares[destination],\n            theirFares: theirFares[destination]\n        }\n    }\n    return candidates;\n}\n\nasync function* getFares(state) {\n    const yourFares = await getFaresFromAirport(state.yourOrigin, state);\n    const theirFares = await getFaresFromAirport(state.theirOrigin, state);\n    const yourFaresDict = arrayToDict(yourFares);\n    const theirFaresDict = arrayToDict(theirFares);\n    yield getCandidates({yourFares: yourFaresDict, theirFares:theirFaresDict});\n    for(const destination of Object.keys(theirFaresDict)) {\n        if(destination in yourFaresDict) continue;\n        const yourFaresToDestination = await getFaresFromAirport(\n            state.yourOrigin,\n            {...state, destination: {id: destination}}\n        );\n        const yourFaresToDestinationDict = arrayToDict(yourFaresToDestination);\n        const newCandidates = getCandidates({yourFares: yourFaresToDestinationDict, theirFares: theirFaresDict});\n        yield newCandidates;\n        // todo: add to dict\n    }\n    for(const destination of Object.keys(yourFaresDict)) {\n        if(destination in theirFaresDict) continue;\n        const theirFaresToDestination = await getFaresFromAirport(\n            state.theirOrigin,\n            {...state, destination: {id: destination}}\n        );\n        const theirFaresToDestinationDict = arrayToDict(theirFaresToDestination);\n        const newCandidates = getCandidates({yourFares: yourFaresDict, theirFares: theirFaresToDestinationDict});\n        yield newCandidates;\n        // todo: add to dict\n    }\n}\n\nexport default getFares;\n","export default async function cachedFetch({url, expiry}) {\n    const cachedString = localStorage.getItem(url);\n    if(cachedString) {\n        const cached = JSON.parse(cachedString);\n        if(cached.expiry < Date.now()) localStorage.removeItem(url);\n        else return cached.data;\n    }\n    const fetched = await fetch(url);\n    const data = await fetched.json();\n    localStorage.setItem(\n        url,\n        JSON.stringify({data: data, expiry: expiry})\n    );\n    return data;\n}\n","import React from 'react';\nimport TextField from '@material-ui/core/TextField';\nimport Autocomplete from '@material-ui/lab/Autocomplete';\nimport LocationOnIcon from '@material-ui/icons/LocationOn';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport { makeStyles } from '@material-ui/core/styles';\nimport parse from 'autosuggest-highlight/parse';\nimport match from 'autosuggest-highlight/match';\nimport throttle from 'lodash/throttle';\nimport cachedFetch from \"./cachedFetch\";\n\nconst useStyles = makeStyles(theme => ({\n    icon: {\n        color: theme.palette.text.secondary,\n        marginRight: theme.spacing(2),\n    },\n}));\n\nconst getURL = async (url) => await cachedFetch({\n    url: url,\n    expiry: new Date(new Date() + 1000 * 60 * 60 * 24 * 7)\n});\n\nasync function locationSearch({term, id}) {\n    const url = 'https://kiwiproxy.herokuapp.com/locations/' + (id ? `id?id=${id}` : `/query?&term=${term}`);\n    const locations = await getURL(url);\n    return locations.locations.map(location => Object.assign(location, {'input': term || id}))\n}\n\nexport default function AirportSelector(props) {\n    const classes = useStyles();\n    const [inputValue, setInputValue] = React.useState('');\n    const [options, setOptions] = React.useState([]);\n\n    const handleSearch = (event, value) => {\n        setInputValue(event.target.value);\n    };\n\n    const handleChange = (event, value) => {\n        props.onChange({\n            target:{\n                name: props.name,\n                value: value\n            }\n        });\n    }\n\n    const ourFetch = React.useMemo(\n        () => throttle(\n            async function(input, callback) {\n                const locations = await locationSearch({term: input});\n                callback(locations);\n            },\n            200\n        ),\n        [],\n    );\n\n    React.useEffect(\n        () => {\n            let active = true;\n            if (inputValue === '') {\n                setOptions([]);\n                return undefined;\n            }\n            ourFetch(\n                inputValue,\n                results => {\n                    if (active) {\n                        setOptions(results || []);\n                    }\n                }\n            );\n\n            return () => {\n                active = false;\n            };\n        },\n        [inputValue, ourFetch]\n    );\n\n    return (\n        <Autocomplete\n            style={{ width: \"240px\" }}\n            getOptionLabel={option => (typeof option === 'string' ? option : option.name)}\n            filterOptions={x => x}\n            options={options}\n            onChange={handleChange}\n            value={props.value}\n            renderInput={params => (\n                <TextField\n                    required={props.required}\n                    {...params}\n                    label={props.label}\n                    variant=\"outlined\"\n                    fullWidth\n                    onChange={handleSearch}\n                />\n            )}\n            renderOption={option => {\n                const parts = parse(\n                    option.name,\n                    match(option.name, option.input)\n                );\n\n                return (\n                    <Grid container alignItems=\"center\">\n                        <Grid item>\n                            <LocationOnIcon className={classes.icon} />\n                        </Grid>\n                        <Grid item xs>\n                            {parts.map((part, index) => (\n                                <span key={index} style={{ fontWeight: part.highlight ? 700 : 400 }}>\n                                    {part.text}\n                                </span>\n                            ))}\n\n                            <Typography variant=\"body2\" color=\"textSecondary\">\n                                {option.name}\n                            </Typography>\n                        </Grid>\n                    </Grid>\n                );\n            }}\n        />\n    );\n}\n","import getFares from './flightsearch.js';\nimport Grid from '@material-ui/core/Grid';\nimport {\n  MuiPickersUtilsProvider,\n  DatePicker\n} from '@material-ui/pickers';\nimport MomentUtils from '@date-io/moment';\nimport moment from \"moment\";\nimport Button from '@material-ui/core/Button';\nimport React from 'react';\nimport AirportSelector from './AirportSelector.js';\n\n\nfunction nextThursday() {\n    return moment().add((moment().isoWeekday() >= 4  ? 12 : 4) - moment().isoWeekday(), 'days');\n}\n\nconst requiredParams = ['departureDate', 'returnDate', 'yourOrigin', 'theirOrigin'];\n\nasync function fillDefault(whichAirport, state) {\n    if(state[whichAirport]) {\n        const url = `https://kiwiproxy.herokuapp.com/locations/id?id=${state[whichAirport]}`;\n        const locationJson = await fetch(url);\n        const locations = await locationJson.json();\n        state[whichAirport] = locations.locations.filter(\n            x => x.id === state[whichAirport]\n        )[0];\n    }\n}\n\nclass Form extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            departureDate: nextThursday(),\n            returnDate: nextThursday().add(4, 'days'),\n            destination: \"\",\n            ...props.query\n        };\n        \n        this.state.departureDate = moment(this.state.departureDate);\n        this.state.returnDate = moment(this.state.returnDate);\n        this.allowSubmit = this.allowSubmit.bind(this);\n        this.startLoading = props.startLoading;\n        this.finishLoading = props.finishLoading;\n        this.handleChange = this.handleChange.bind(this);\n        this.handleSubmit = this.handleSubmit.bind(this);\n        this.doStuff = this.doStuff.bind(this);\n        //this.componentDidUpdate = this.componentDidUpdate.bind(this);\n        this.setDepartureDate = this.setDepartureDate.bind(this);\n        async function fillDefaults(state, allowSubmit, doStuff) {\n            await fillDefault('yourOrigin', state);\n            await fillDefault('theirOrigin', state);\n            await fillDefault('destination', state);\n            if (allowSubmit()) doStuff();\n        }\n        fillDefaults(this.state, this.allowSubmit, this.doStuff);\n    }\n\n    componentDidUpdate(prevProps, prevState, snapshot) {\n        const setState = this.setState.bind(this)\n        const oldMatch = prevProps.query;\n        const newMatch = this.props.query;\n        if(newMatch.returnDate !== oldMatch.returnDate) {\n            this.setState({returnDate: moment(newMatch.returnDate)});\n        }\n        if(newMatch.dateFlexibility !== oldMatch.dateFlexibility) {\n            this.setState({dateFlexibility: newMatch.dateFlexibility});\n        }\n        \n        if(newMatch.max_stopovers !== oldMatch.max_stopovers) {\n            this.setState({max_stopovers: newMatch.max_stopovers});\n        }\n        if(newMatch.departureDate !== oldMatch.departureDate) this.setDepartureDate(newMatch.departureDate);\n        async function setAirport(which)  {\n            if(newMatch[which] !== oldMatch[which]) {\n                const newState = {};\n                newState[which] = newMatch[which];\n                await fillDefault(which, newState);\n                setState(newState);\n            }\n        }\n        setAirport('yourOrigin');\n        setAirport('theirOrigin');\n        setAirport('destination');\n    }\n    \n    handleChange = function(e) {\n        this.setState({ [e.target.name]: e.target.value });\n    }\n\n    handleSubmit(event) {\n        event.preventDefault();\n    }\n\n    allowSubmit() {\n        return requiredParams.reduce(\n            (tot, par) => tot && !!this.state[par],\n            true\n        ) && !this.props.loading;\n    }\n\n    setDepartureDate(newDate) {\n        if(newDate > this.state.returnDate) {\n            this.setState({\n                returnDate: moment(this.state.returnDate + (newDate - this.state.departureDate))\n            });\n        }\n        this.setState({departureDate: moment(newDate)});\n    }\n\n    async doStuff() {\n        this.startLoading();\n        this.props.clearCandidates();\n        this.props.setQuery({\n            yourOrigin: this.state.yourOrigin.id,\n            theirOrigin: this.state.theirOrigin.id,\n            destination: this.state.destination ? this.state.destination.id : undefined,\n            departureDate: this.state.departureDate.toDate(),\n            returnDate: this.state.returnDate.toDate()\n        });\n        for await (const fares of await getFares(this.state)) this.props.addCandidates(fares);\n        this.finishLoading();\n    }\n\n    renderInput = input => input.name;\n\n    render() {\n        return (\n            <form onSubmit={this.handleSubmit} >\n                <Grid container spacing={2}>\n                    <Grid item sm={6} md={3} xl={2}>\n                        <MuiPickersUtilsProvider name=\"departureDate\" utils={MomentUtils}>\n                            <DatePicker\n                                required\n                                disablePast\n                                variant=\"inline\"\n                                label=\"Departure\"\n                                value={this.state.departureDate}\n                                inputVariant=\"outlined\"\n                                onChange={this.setDepartureDate}\n                            />\n                            </MuiPickersUtilsProvider>\n                    </Grid>\n                    <Grid item sm={6} md={3} xl={2}>\n                        <MuiPickersUtilsProvider name=\"returnDate\" utils={MomentUtils}>\n                            <DatePicker\n                                required\n                                variant=\"inline\"\n                                label=\"Return\"\n                                value={this.state.returnDate}\n                                inputVariant=\"outlined\"\n                                onChange={d => this.setState({returnDate: d})}\n                                minDate={this.state.departureDate}\n                            />\n                            </MuiPickersUtilsProvider>\n                    </Grid>\n                    <Grid item sm={6} md={3} xl={2}>\n                        <AirportSelector\n                            startLoading={this.startLoading}\n                            finishLoading={this.finishLoading}\n                            required\n                            id=\"yourOrigin\"\n                            name=\"yourOrigin\"\n                            value={this.state.yourOrigin}\n                            onChange={this.handleChange}\n                            label=\"Your origin\"\n                            renderInput={this.renderInput}\n                        />\n                    </Grid>\n                    <Grid item sm={6} md={3} xl={2}>\n                        <AirportSelector\n                            startLoading={this.startLoading}\n                            finishLoading={this.finishLoading}\n                            required\n                            id=\"theirOrigin\"\n                            name=\"theirOrigin\"\n                            value={this.state.theirOrigin}\n                            onChange={this.handleChange}\n                            label=\"Their origin\"\n                            renderInput={this.renderInput}\n                        />\n                    </Grid>\n                    <Grid item sm={6} md={3} xl={2}>\n                        <AirportSelector\n                            startLoading={this.startLoading}\n                            finishLoading={this.finishLoading}\n                            id=\"destination\"\n                            name=\"destination\"\n                            value={this.state.destination}\n                            onChange={this.handleChange}\n                            label=\"Destination\"\n                            renderInput={this.renderInput}\n                        />\n                    </Grid>\n                    <Grid item sm={6} md={3} xl={2}>\n                        <Button variant=\"contained\" color=\"primary\" disabled={!this.allowSubmit()} onClick={this.doStuff}>Search</Button>\n                    </Grid>\n                </Grid>\n                \n            </form>\n        );\n    }\n}\n\nexport default Form\n","import moment from \"moment\";\nimport { Chart } from \"react-google-charts\";\nimport React from 'react';\nimport CardHeader from \"@material-ui/core/CardHeader\";\nimport CardActions from '@material-ui/core/CardActions';\nimport CloseIcon from '@material-ui/icons/Close';\nimport {\n    Typography,\n    MenuItem,\n    Slider,\n    Select,\n    Grid,\n    Link,\n    Tabs,\n    Tab,\n    Paper,\n    Card,\n    CardContent,\n    Avatar,\n    IconButton,\n} from '@material-ui/core';\n\nexport default function ResultsTable(props) {\n    const setDestination = (event, newValue) => {\n        props.setQuery({expand: newValue, theirFlight: null, yourFlight: null});\n    };\n    const setYourFlight = (newValue) => props.setQuery({yourFlight: newValue});\n    const setTheirFlight = (newValue) => props.setQuery({theirFlight: newValue});\n    const setYourMaxPrice = (event, value) => props.setQuery({yourMaxPrice: value});\n    const setTheirMaxPrice = (event, value) => props.setQuery({theirMaxPrice: value});\n    const setSortBy = (event, newValue) => props.setQuery({sortBy: event.target.value});\n    const airports = Object.keys(props.candidates);\n    const value = airports.indexOf(props.query.expand) !== -1 ? props.query.expand : false;\n    return (\n        <Paper>\n            <Tabs variant=\"scrollable\" scrollButtons=\"auto\" value={value} onChange={setDestination}>\n                {Object.values(props.candidates).map(\n                    candidate => {\n                        const myFirst = candidate.yourFares[0];\n                        const price = minPrice(candidate.yourFares) + minPrice(candidate.theirFares);\n                        const label = `€ ${price} ${myFirst.cityTo}, ${myFirst.countryTo.name}`;\n                        return <Tab key={myFirst.cityCodeTo} value={myFirst.cityCodeTo} label={label}/>;\n                    }\n                )\n                }\n            </Tabs>\n            <FlightSelector\n                cityCodeTo={props.query.expand}\n                yourFlight={props.query.yourFlight}\n                theirFlight={props.query.theirFlight}\n                candidates={props.candidates}\n                setYourFlight={setYourFlight}\n                setTheirFlight={setTheirFlight}\n                sortBy={props.query.sortBy || 'price'}\n                setSortBy={setSortBy}\n                yourMaxPrice={props.query.yourMaxPrice}\n                theirMaxPrice={props.query.theirMaxPrice}\n                setYourMaxPrice={setYourMaxPrice}\n                setTheirMaxPrice={setTheirMaxPrice}\n            />\n            <SelectedFlights\n                yourFlight={props.query.yourFlight}\n                theirFlight={props.query.theirFlight}\n                setTheirFlight={setTheirFlight}\n                setYourFlight={setYourFlight}\n                flights={props.candidates[props.query.expand]}\n            />\n        </Paper>\n    )\n}\n\nfunction minPrice(fares) {\n    return Math.min(...(fares.map(fare => fare.price)));\n}\n\nfunction formatTime(time) {\n    return moment(time).format('DD MMM HH:mm');\n}\n\nfunction fareToDatum({fare, yourFlight, theirFlight}) {\n    const selection = yourFlight || theirFlight;\n    if(yourFlight && fare.yoursOrTheirs === 'yours' && fare.id !== yourFlight) return null;\n    if(theirFlight && fare.yoursOrTheirs === 'theirs' && fare.id !== theirFlight) return null;\n    const returnLeg = fare.route[fare.route.length - 1];\n    const price = `€ ${fare.price}`\n    const there = `${fare.flyFrom} -> ${fare.flyTo} ${formatTime(fare.local_departure)} – ${formatTime(fare.local_arrival)}`;\n    const back = `${returnLeg.flyFrom} -> ${returnLeg.flyTo} ${formatTime(returnLeg.local_departure)} – ${formatTime(returnLeg.local_arrival)}`;\n    const label = `${price} | ${there} | ${back}`;\n    const tooltip = fare.route.reduce(\n        (output, leg) => `${output}<br/>${formatTime(leg.local_departure)} ${leg.flyFrom} -> ${leg.flyTo} ${formatTime(leg.local_arrival)}}`,\n        price\n    );\n    const colors = {\n        theirs: ['#DC3912', '#FFAAAA'],\n        yours: ['#3366CC', '#88AAFF']\n    }[fare.yoursOrTheirs];\n    const flight_color = fare.id === selection ? colors[1] : colors[0];\n    const gap_color = fare.id === selection ? colors[0] : colors[1];\n    const bars = [];\n    let previousLeg;\n    for(const leg of fare.route) {\n        bars.push([\n            fare.id,\n            '',\n            `color: ${flight_color};`,\n            tooltip,\n            new Date(leg.utc_departure),\n            new Date(leg.utc_arrival)\n        ]);\n        if(previousLeg) bars.push([\n            fare.id,\n            previousLeg.flyTo === fare.flyTo ? label : '',\n            `color: ${gap_color};`,\n            tooltip,\n            new Date(previousLeg.utc_arrival),\n            new Date(leg.utc_departure)\n        ]);\n        previousLeg = leg;\n    };\n    return bars;\n}\n\nfunction addYoursOrTheirs(fares, yoursOrTheirs) {\n    return fares.map(x => {\n        return {...x, ...{yoursOrTheirs: yoursOrTheirs}}\n    });\n}\n\nfunction FlightSelector({\n    cityCodeTo,\n    candidates,\n    yourFlight,\n    theirFlight,\n    setYourFlight,\n    setTheirFlight,\n    sortBy,\n    setSortBy,\n    yourMaxPrice,\n    theirMaxPrice,\n    setYourMaxPrice,\n    setTheirMaxPrice,\n}) {\n    if(yourFlight && theirFlight) return null;\n    if(cityCodeTo in candidates);\n    else return null;\n    const fares = [\n        ...addYoursOrTheirs(candidates[cityCodeTo].yourFares, 'yours'),\n        ...addYoursOrTheirs(candidates[cityCodeTo].theirFares, 'theirs'),\n    ];\n    fares.sort((x, y) => {\n        if(x.id === theirFlight || x.id === yourFlight) return -1;\n        if(y.id === theirFlight || y.id === yourFlight) return 1;\n        if(sortBy === 'price') return Math.sign(x.price - y.price);\n        if(sortBy === 'time') {\n            const ret = Math.sign(\n                new Date(x.utc_departure) - new Date(y.utc_departure) ||\n                new Date(x.utc_arrival) - new Date(y.utc_arrival) ||\n                new Date(x.utc_arrival) - new Date(y.utc_arrival) ||\n                new Date(x.route[x.route.length - 1].utc_arrival) - new Date(y.route[y.route.length - 1].utc_arrival) ||\n                x.price - y.price\n            );\n            return ret;\n        }\n        return 0;\n    });\n\n    const data_param = [\n        [\n            { type: 'string', id: 'id' },\n            { type: 'string', id: 'label' },\n            { type: 'string', role: 'style' },\n            { type: 'string', role: 'tooltip', p: {'html': true}},\n            { type: 'date', id: 'Start' },\n            { type: 'date', id: 'End' }\n        ],\n        ...fares.filter(fare => {\n            const maxPrice = {yours: yourMaxPrice, theirs: theirMaxPrice}[fare.yoursOrTheirs];\n            return !maxPrice || maxPrice >= fare.price;\n        }).map(\n            fare => fareToDatum({fare:fare, yourFlight: yourFlight, theirFlight: theirFlight})\n        ).filter(x => x).flat()\n    ];\n    const chartEvents=[\n      {\n        eventName: 'select',\n        callback: function({chartWrapper}) {\n            const chartSelection = chartWrapper.getChart().getSelection();\n            const selectedFareID = data_param[chartSelection[0].row][0];\n            const selectedFare = fares.filter(x => x.id === selectedFareID)[0];\n            if(selectedFare.yoursOrTheirs === 'yours') {\n                if(selectedFare.id === yourFlight) setYourFlight('');\n                else setYourFlight(selectedFare.id);\n            }\n            else if(selectedFare.yoursOrTheirs === 'theirs') {\n                if(selectedFare.id === theirFlight) setTheirFlight('');\n                else setTheirFlight(selectedFare.id);\n            }\n            else console.error('unexpected yoursOrTheirs', selectedFare.yoursOrTheirs);\n        }\n      }\n    ];\n    const yourMax = fares.filter(f => f.yoursOrTheirs === 'yours').reduce((maxPrice, fare) => Math.max(fare.price, maxPrice), 0);\n    const theirMax = fares.filter(f => f.yoursOrTheirs === 'theirs').reduce((maxPrice, fare) => Math.max(fare.price, maxPrice), 0);\n    const yourMin = fares.filter(f => f.yoursOrTheirs === 'yours').reduce((minPrice, fare) => Math.min(fare.price, minPrice), Infinity);\n    const theirMin = fares.filter(f => f.yoursOrTheirs === 'theirs').reduce((minPrice, fare) => Math.min(fare.price, minPrice), Infinity);\n    return (\n        <div>\n            <Grid container spacing={10}>\n                <Grid item xs/>\n                <Grid item xs>\n                    <Typography gutterBottom>Sorting</Typography>\n                    <Select onChange={setSortBy} value={sortBy}>\n                        <MenuItem value=\"price\">↑Price</MenuItem>\n                        <MenuItem value=\"time\">↑Time</MenuItem>\n                    </Select>\n                </Grid>\n                <Grid item xs>\n                    <Typography gutterBottom>Max price</Typography>\n                    <Slider\n                        defaultValue={yourMaxPrice || yourMax}\n                        onChangeCommitted={setYourMaxPrice}\n                        valueLabelDisplay=\"auto\"\n                        min={yourMin}\n                        max={yourMax}\n                    />\n                </Grid>\n                <Grid item xs>\n                    <Typography gutterBottom>Max price</Typography>\n                    <Slider\n                        defaultValue={theirMaxPrice || theirMax}\n                        onChangeCommitted={setTheirMaxPrice}\n                        valueLabelDisplay=\"auto\"\n                        color=\"secondary\"\n                        min={theirMin}\n                        max={theirMax}\n                    />\n                </Grid>\n                <Grid item xs/>\n            </Grid>\n            <Chart\n                width={'100%'}\n                height={yourFlight && theirFlight ? '200px' : '800px'}\n                chartType=\"Timeline\"\n                loader={<div>Loading Chart</div>}\n                data={data_param}\n                chartEvents={chartEvents} // <- this is event handler\n                options={{\n                    timeline: {\n                        colorByRowLabel: false,\n                        groupByRowLabel: true,\n                        showRowLabels: false\n                    },\n                    tooltip: {\n                        isHtml: true\n                    }\n\n                }}\n                rootProps={{ 'data-testid': '1' }}\n            />\n        </div>\n    );\n}\n\nfunction SelectedFlights({yourFlight, theirFlight, flights, setTheirFlight, setYourFlight}) {\n    if(!flights) return null;\n    const theirs = theirFlight && flights.theirFares.filter(c => c.id === theirFlight)[0];\n    const yours = yourFlight && flights.yourFares.filter(c => c.id === yourFlight)[0];\n    if(!theirs && !yours) return null;\n    return <Paper>\n        <Grid container spacing={10}>\n            {theirs && <Flight flight={theirs} clearFlight={() => setTheirFlight(null)}/>}\n            {yours && <Flight flight={yours} clearFlight={() => setYourFlight(null)}/>}\n        </Grid>\n    </Paper>\n}\n\nfunction Flight({flight, clearFlight}) {\n    return <Grid item>\n        <Card>\n            <CardHeader\n                title={`${flight.cityFrom} -> ${flight.cityTo}`}\n                action={<IconButton aria-label=\"delete\" onClick={clearFlight}><CloseIcon/></IconButton>}\n            />\n            {flight.route.map(\n                leg => {\n                    return <div key={leg.id}>\n                        <Avatar src={`https://images.kiwi.com/airlines/64/${leg.airline}.png`}/>\n                        <CardContent>\n                            {formatTime(leg.local_departure)} {leg.cityFrom} ({leg.flyFrom})\n                            <br/>\n                            {formatTime(leg.local_arrival)} {leg.cityTo} ({leg.flyTo})\n                        </CardContent>\n                    </div>\n                }\n            )}\n            <CardActions>\n                <Link target=\"_blank\" rel=\"noopener\" href={flight.deep_link}>€ {flight.price}</Link>\n            </CardActions>\n        </Card>\n    </Grid>\n}\n","import moment from \"moment\";\nimport React from 'react';\nimport './App.css';\nimport Form from './Form.js';\nimport ResultsTable from './ResultsTable.js';\nimport {\n  useQueryParams,\n  StringParam,\n  DateParam,\n  NumberParam,\n} from 'use-query-params';\n\n// for tabulator\nwindow.moment = moment;\nmoment.updateLocale('en', {\n    week: {\n      dow: 1,\n    },\n});\n\nfunction App(props) {\n    const [query, setQuery] = useQueryParams({\n        destination: StringParam,\n        theirOrigin: StringParam,\n        yourOrigin: StringParam,\n        departureDate: DateParam,\n        returnDate: DateParam,\n        dateFlexibility: NumberParam,\n        max_stopovers: NumberParam,\n        expand: StringParam,\n        yourFlight: StringParam,\n        theirFlight: StringParam,\n        sortBy: StringParam,\n        yourMaxPrice: NumberParam,\n        theirMaxPrice: NumberParam,\n    });\n    const [loading, setLoading] = React.useState(0);\n    const [candidates, setCandidates] = React.useState({});\n    const startLoading = () => setLoading(loading + 1);\n    const finishLoading = () => setLoading(loading - 1);\n    const addCandidates = (newCandidates) => setCandidates({...candidates, ...newCandidates});\n    const clearCandidates = () => setCandidates([]);\n    return (\n        <div>\n            <Form\n                addCandidates={addCandidates}\n                clearCandidates={clearCandidates}\n                startLoading={startLoading}\n                finishLoading={finishLoading}\n                loading={loading > 0}\n                query={query}\n                setQuery={setQuery}\n            />\n            <Loading id=\"loading\" loading={loading > 0}/>\n            <ResultsTable candidates={candidates} setQuery={setQuery} query={query}/>\n        </div>\n  );\n}\n\nfunction Loading(props) {\n    return <div id={props.id}>{props.loading ? '✈' : ''}</div>;\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport { Route, HashRouter as Router } from 'react-router-dom'\nimport { QueryParamProvider } from 'use-query-params';\nimport App from './App'\n\nconst routing = (\n<Router>\n    <QueryParamProvider ReactRouterRoute={Route}>\n        <App />\n    </QueryParamProvider>\n</Router>\n)\n\nReactDOM.render(routing, document.getElementById('root'))\n"],"sourceRoot":""}